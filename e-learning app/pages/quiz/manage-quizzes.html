<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>จัดการข้อสอบ - E-Learning Platform</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../assets/css/main.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- DataTables Bootstrap 5 -->
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <!-- DataTables Responsive -->
    
    <!-- Custom CSS -->
    <style>
        /* ป้องกันไม่ให้คอลัมน์ "การดำเนินการ" wrap */
        .content-action-col,
        th.content-action-col,
        td.content-action-col {
            white-space: nowrap !important;
            width: auto !important;
            min-width: 120px !important;
        }
        
        /* ปรับขนาดคอลัมน์อื่นๆ ให้เหมาะสม */
        .content-name-col {
            width: 25% !important;
        }
        
        .content-type-col {
            width: 8% !important;
        }
        
        .content-link-col {
            width: 10% !important;
        }
        
        .content-desc-col {
            width: 25% !important;
        }
        
        .content-course-col {
            width: 15% !important;
        }
        
        .content-date-col {
            width: 12% !important;
        }
    </style>
    
    <!-- Date Formatter Utility -->
    <script src="../../assets/js/utils/date-formatter-legacy.js"></script>
</head>
<body>
    <!-- เมนูนำทาง -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="../dashboard/admin-dashboard.html">
                <i class="bi bi-mortarboard-fill me-2"></i>
                E-Learning Platform
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" title="เปิด/ปิดเมนู">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto" id="mainMenu">
                    <li class="nav-item">
                        <a class="nav-link" href="../dashboard/admin-dashboard.html">
                            <i class="bi-house me-1"></i>
                            หน้าหลัก
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link" href="../users/manage-users.html">
                            <i class="bi-people me-1"></i>
                            จัดการผู้ใช้
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link" href="../courses/manage-courses.html">
                            <i class="bi-book me-1"></i>
                            จัดการคอร์ส
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link active" href="manage-quizzes.html">
                            <i class="bi-question-circle me-1"></i>
                            จัดการข้อสอบ
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link" href="../reports/system-reports.html">
                            <i class="bi-graph-up me-1"></i>
                            รายงานระบบ
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link" href="../settings/system-settings.html">
                            <i class="bi-gear me-1"></i>
                            การตั้งค่า
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" id="userDropdown">
                            <i class="bi bi-person-circle me-1"></i>
                            <span id="userName">แอดมิน</span>
                        </a>
                        <ul class="dropdown-menu" id="userMenu">
                            <li>
                                <a class="dropdown-item" href="#" data-action="logout">
                                    <i class="bi-box-arrow-right me-2"></i>
                                    ออกจากระบบ
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- เนื้อหาหลัก -->
            <main class="col-12 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">จัดการข้อสอบ</h1>
                </div>

                <!-- ตารางจัดการเนื้อหา -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-link-45deg me-2"></i>
                            จัดการเนื้อหา
                        </h5>
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addContentModal">
                            <i class="bi bi-plus-circle me-1"></i>เพิ่มเนื้อหา
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover datatable" id="contentTable" data-datatable="true" data-responsive="true">
                                <thead>
                                    <tr>
                                        <th class="content-name-col">ชื่อเนื้อหา</th>
                                        <th class="content-type-col">ประเภท</th>
                                        <th class="content-link-col">ลิงก์</th>
                                        <th class="content-desc-col">คำอธิบาย</th>
                                        <th class="content-course-col">คอร์สที่เกี่ยวข้อง</th>
                                        <th class="content-date-col">วันที่เพิ่ม</th>
                                        <th class="content-action-col">การดำเนินการ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- ข้อมูลเนื้อหาจะถูกโหลดโดย JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ตารางข้อสอบ -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-question-circle me-2"></i>
                            รายการข้อสอบทั้งหมด
                        </h5>
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createQuizModal">
                                <i class="bi bi-plus-circle me-1"></i>สร้างข้อสอบใหม่
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="exportQuizzes()">
                                <i class="bi bi-download me-1"></i>Export
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover w-100 datatable" id="quizzesTable" data-datatable="true" data-responsive="true">
                                <thead>
                                    <tr>
                                        <th>ชื่อข้อสอบ</th>
                                        <th>คอร์ส</th>
                                        <th>จำนวนข้อ</th>
                                        <th>เวลาทำ</th>
                                        <th>สถานะ</th>
                                        <th>วันที่สร้าง</th>
                                        <th>การดำเนินการ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- ข้อมูลข้อสอบจะถูกอัปเดตโดย JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal แก้ไขข้อสอบ -->
    <div class="modal fade" id="editQuizModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">แก้ไขข้อสอบ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิด"></button>
                </div>
                <div class="modal-body">
                    <!-- ฟอร์มแก้ไขข้อสอบ -->
                    <form id="editQuizForm">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="editQuizTitle" class="form-label">ชื่อข้อสอบ *</label>
                                <input type="text" class="form-control" id="editQuizTitle" required>
                            </div>
                            <div class="col-md-4">
                                <label for="editQuizDuration" class="form-label">เวลาทำข้อสอบ (นาที) *</label>
                                <input type="number" class="form-control" id="editQuizDuration" min="1" value="30" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editQuizDescription" class="form-label">คำอธิบายข้อสอบ</label>
                            <textarea class="form-control" id="editQuizDescription" rows="3"></textarea>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="editCourseId" class="form-label">คอร์ส</label>
                                <select class="form-select" id="editCourseId">
                                    <option value="">เลือกคอร์ส</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="editMaxAttempts" class="form-label">จำนวนครั้งที่ทำได้</label>
                                <input type="number" class="form-control" id="editMaxAttempts" min="1" value="1">
                            </div>
                            <div class="col-md-4">
                                <label for="editPassingScore" class="form-label">คะแนนผ่าน (%)</label>
                                <input type="number" class="form-control" id="editPassingScore" min="0" max="100" value="70">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editAutoSubmit">
                                    <label class="form-check-label" for="editAutoSubmit">
                                        ส่งข้อสอบอัตโนมัติเมื่อหมดเวลา
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editRequireAllAnswers">
                                    <label class="form-check-label" for="editRequireAllAnswers">
                                        ต้องตอบทุกข้อ
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="editQuizStatus" class="form-label">สถานะ</label>
                                <select class="form-select" id="editQuizStatus">
                                    <option value="active">เปิดใช้งาน</option>
                                    <option value="inactive">ปิดใช้งาน</option>
                                </select>
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    ข้อสอบที่ปิดใช้งานจะไม่แสดงให้นักเรียนเห็น
                                </div>
                            </div>
                        </div>
                        
                        <!-- ส่วนคำถาม -->
                        <hr>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">
                                    <i class="bi bi-question-circle me-2"></i> คำถาม
                                </h6>
                            </div>
                            <div id="editQuestionsContainer">
                                <!-- คำถามจะถูกเพิ่มที่นี่ -->
                            </div>
                            
                            <!-- แสดงคะแนนรวมสำหรับฟอร์มแก้ไข -->
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="alert alert-info d-flex align-items-center" role="alert">
                                        <i class="bi bi-info-circle me-2"></i>
                                        <div>
                                            <strong>คะแนนรวม:</strong> 
                                            <span id="editTotalScore" class="badge bg-warning ms-2">0</span> 
                                            <span class="text-muted">/ 100 คะแนน</span>
                                            <br>
                                            <small class="text-muted">
                                                <i class="bi bi-lightbulb me-1"></i>
                                                กำหนดคะแนนแต่ละข้อให้รวมเป็น 100 คะแนน เพื่อให้การคำนวณเปอร์เซ็นต์ง่ายขึ้น
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-primary" id="saveEditQuizBtn">
                        <i class="bi bi-save me-1"></i>บันทึกการแก้ไข
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal สร้างข้อสอบใหม่ -->
    <div class="modal fade" id="createQuizModal" tabindex="-1" aria-labelledby="createQuizModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createQuizModalLabel">
                        <i class="bi bi-plus-circle me-2"></i>
                        สร้างข้อสอบใหม่
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิดหน้าต่างสร้างข้อสอบใหม่"></button>
                </div>
                <form id="createQuizForm">
                    <div class="modal-body">
                        <!-- ข้อมูลพื้นฐานข้อสอบ -->
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="quizTitle" class="form-label">ชื่อข้อสอบ *</label>
                                <input type="text" class="form-control" id="quizTitle" required>
                            </div>
                            <div class="col-md-4">
                                <label for="quizDuration" class="form-label">เวลาทำข้อสอบ (นาที) *</label>
                                <input type="number" class="form-control" id="quizDuration" min="1" value="30" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="quizDescription" class="form-label">คำอธิบายข้อสอบ</label>
                            <textarea class="form-control" id="quizDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="courseId" class="form-label">คอร์ส</label>
                                <select class="form-select" id="courseId">
                                    <option value="">เลือกคอร์ส</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="maxAttempts" class="form-label">จำนวนครั้งที่ทำได้</label>
                                <input type="number" class="form-control" id="maxAttempts" min="1" value="1">
                            </div>
                            <div class="col-md-4">
                                <label for="passingScore" class="form-label">คะแนนผ่าน (%)</label>
                                <input type="number" class="form-control" id="passingScore" min="0" max="100" value="70">
                            </div>
                        </div>
                        
                        <!-- แสดงคะแนนรวม -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="alert alert-info d-flex align-items-center" role="alert">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <div>
                                        <strong>คะแนนรวม:</strong> 
                                        <span id="totalScore" class="badge bg-primary ms-2">0</span> 
                                        <span class="text-muted">/ 100 คะแนน</span>
                                        <br>
                                        <small class="text-muted">
                                            <i class="bi bi-lightbulb me-1"></i>
                                            กำหนดคะแนนแต่ละข้อให้รวมเป็น 100 คะแนน เพื่อให้การคำนวณเปอร์เซ็นต์ง่ายขึ้น
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="autoSubmit">
                                    <label class="form-check-label" for="autoSubmit">
                                        ส่งข้อสอบอัตโนมัติเมื่อหมดเวลา
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="requireAllAnswers">
                                    <label class="form-check-label" for="requireAllAnswers">
                                        ต้องตอบทุกข้อ
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="quizStatus" class="form-label">สถานะ</label>
                                <select class="form-select" id="quizStatus">
                                    <option value="active">เปิดใช้งาน</option>
                                    <option value="inactive">ปิดใช้งาน</option>
                                </select>
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    ข้อสอบที่ปิดใช้งานจะไม่แสดงให้นักเรียนเห็น
                                </div>
                            </div>
                        </div>
                        
                        <!-- เงื่อนไขแผนกที่สามารถทำข้อสอบได้ -->
                        <div class="mb-3">
                            <label class="form-label">
                                <i class="bi bi-building me-2"></i>
                                แผนกที่สามารถทำข้อสอบได้
                            </label>
                            <div class="form-text mb-2">
                                <i class="bi bi-info-circle me-1"></i>
                                เลือกแผนกที่อนุญาตให้ทำข้อสอบนี้ (ไม่เลือก = ทุกแผนกสามารถทำได้)
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="บัญชี/การเงิน" id="dept-accounting">
                                        <label class="form-check-label" for="dept-accounting">
                                            บัญชี/การเงิน
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="ทรัพยากรบุคคล" id="dept-hr">
                                        <label class="form-check-label" for="dept-hr">
                                            ทรัพยากรบุคคล
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="เทคโนโลยีสารสนเทศ" id="dept-it">
                                        <label class="form-check-label" for="dept-it">
                                            เทคโนโลยีสารสนเทศ
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การตลาด" id="dept-marketing">
                                        <label class="form-check-label" for="dept-marketing">
                                            การตลาด
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การขาย" id="dept-sales">
                                        <label class="form-check-label" for="dept-sales">
                                            การขาย
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การผลิต" id="dept-production">
                                        <label class="form-check-label" for="dept-production">
                                            การผลิต
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การวิจัยและพัฒนา" id="dept-rd">
                                        <label class="form-check-label" for="dept-rd">
                                            การวิจัยและพัฒนา
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การบริการลูกค้า" id="dept-customer-service">
                                        <label class="form-check-label" for="dept-customer-service">
                                            การบริการลูกค้า
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การจัดซื้อ" id="dept-procurement">
                                        <label class="form-check-label" for="dept-procurement">
                                            การจัดซื้อ
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การขนส่ง" id="dept-transportation">
                                        <label class="form-check-label" for="dept-transportation">
                                            การขนส่ง
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การบำรุงรักษา" id="dept-maintenance">
                                        <label class="form-check-label" for="dept-maintenance">
                                            การบำรุงรักษา
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การควบคุมคุณภาพ" id="dept-quality">
                                        <label class="form-check-label" for="dept-quality">
                                            การควบคุมคุณภาพ
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การฝึกอบรม" id="dept-training">
                                        <label class="form-check-label" for="dept-training">
                                            การฝึกอบรม
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="การสื่อสารองค์กร" id="dept-communications">
                                        <label class="form-check-label" for="dept-communications">
                                            การสื่อสารองค์กร
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="กฎหมาย" id="dept-legal">
                                        <label class="form-check-label" for="dept-legal">
                                            กฎหมาย
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="ความปลอดภัย" id="dept-security">
                                        <label class="form-check-label" for="dept-security">
                                            ความปลอดภัย
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="สิ่งแวดล้อม" id="dept-environment">
                                        <label class="form-check-label" for="dept-environment">
                                            สิ่งแวดล้อม
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input department-checkbox" type="checkbox" value="อื่นๆ" id="dept-others">
                                        <label class="form-check-label" for="dept-others">
                                            อื่นๆ
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" id="selectAllDepartments">
                                    <i class="bi bi-check-all me-1"></i>เลือกทั้งหมด
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="clearAllDepartments">
                                    <i class="bi bi-x-circle me-1"></i>ล้างทั้งหมด
                                </button>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <!-- ส่วนคำถาม -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">
                                    <i class="bi bi-question-circle me-2"></i>
                                    คำถาม
                                </h6>
                            </div>
                            <div id="questionsContainer">
                                <!-- คำถามจะถูกเพิ่มที่นี่ -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                        <button type="button" class="btn btn-outline-primary me-2" id="previewQuizBtn">
                            <i class="bi bi-eye me-1"></i>ดูตัวอย่าง
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-1"></i>บันทึกข้อสอบ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- เทมเพลตคำถาม (ซ่อนไว้) -->
    <template id="multipleChoiceTemplate">
        <div class="question-item card mb-3" data-question-type="multiple-choice">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">คำถามแบบเลือกตอบ</h6>
                <div class="btn-group">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-plus me-1"></i>เพิ่มคำถาม
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="#" onclick="addQuestion('multiple-choice')">
                                    <i class="bi bi-list-check me-2"></i>แบบตัวเลือก
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" onclick="addQuestion('true-false')">
                                    <i class="bi bi-check-square me-2"></i>แบบถูก/ผิด
                                </a>
                            </li>
                        </ul>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger remove-question">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="question-text" class="form-label">คำถาม *</label>
                    <textarea class="form-control question-text" id="question-text" rows="2" placeholder="กรุณากรอกคำถาม" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="options-container" class="form-label">ตัวเลือก</label>
                    <div class="options-container">
                        <div class="input-group mb-2">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0 correct-answer" type="radio" name="correct" value="0" id="correct-0">
                            </div>
                            <input type="text" class="form-control option-text" id="option-0" placeholder="ตัวเลือกที่ 1" required>
                            <button type="button" class="btn btn-outline-danger remove-option">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                        <div class="input-group mb-2">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0 correct-answer" type="radio" name="correct" value="1" id="correct-1">
                            </div>
                            <input type="text" class="form-control option-text" id="option-1" placeholder="ตัวเลือกที่ 2" required>
                            <button type="button" class="btn btn-outline-danger remove-option">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary add-option">
                        <i class="bi bi-plus me-1"></i>เพิ่มตัวเลือก
                    </button>
                </div>
                <div class="mb-3">
                    <label for="explanation" class="form-label">คำอธิบายเฉลย</label>
                    <textarea class="form-control explanation" id="explanation" rows="2" placeholder="คำอธิบายเฉลย (ไม่บังคับ)"></textarea>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="question-score" class="form-label">คะแนน *</label>
                        <div class="input-group">
                            <input type="number" class="form-control question-score" id="question-score" value="10" min="1" max="100" step="1" required>
                            <span class="input-group-text">คะแนน</span>
                        </div>
                        <div class="form-text">
                            <i class="bi bi-info-circle me-1"></i>
                            กำหนดคะแนนสำหรับข้อนี้ (แนะนำให้รวมทุกข้อ = 100 คะแนน)
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">สถานะคะแนน</label>
                        <div class="d-flex align-items-center">
                            <span id="question-score-status" class="badge bg-success">✓ คะแนนเหมาะสม</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- เทมเพลตคำถามแบบถูก/ผิด (ซ่อนไว้) -->
    <template id="trueFalseTemplate">
        <div class="question-item card mb-3" data-question-type="true-false">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">คำถามแบบถูก/ผิด</h6>
                <div class="btn-group">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-plus me-1"></i>เพิ่มคำถาม
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="#" onclick="addQuestion('multiple-choice')">
                                    <i class="bi bi-list-check me-2"></i>แบบตัวเลือก
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" onclick="addQuestion('true-false')">
                                    <i class="bi bi-check-square me-2"></i>แบบถูก/ผิด
                                </a>
                            </li>
                        </ul>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger remove-question">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="question-text" class="form-label">คำถาม *</label>
                    <textarea class="form-control question-text" id="question-text" rows="2" placeholder="กรุณากรอกคำถาม" required></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">เฉลย *</label>
                    <div class="options-container">
                        <div class="form-check">
                            <input class="form-check-input correct-answer" type="radio" name="correct" value="true" id="answer-true">
                            <label class="form-check-label" for="answer-true">
                                <i class="bi bi-check-circle text-success me-1"></i>ถูก (True)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input correct-answer" type="radio" name="correct" value="false" id="answer-false">
                            <label class="form-check-label" for="answer-false">
                                <i class="bi bi-x-circle text-danger me-1"></i>ผิด (False)
                            </label>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="explanation" class="form-label">คำอธิบายเฉลย</label>
                    <textarea class="form-control explanation" id="explanation" rows="2" placeholder="คำอธิบายเฉลย (ไม่บังคับ)"></textarea>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="question-score" class="form-label">คะแนน *</label>
                        <div class="input-group">
                            <input type="number" class="form-control question-score" id="question-score" value="10" min="1" max="100" step="1" required>
                            <span class="input-group-text">คะแนน</span>
                        </div>
                        <div class="form-text">
                            <i class="bi bi-info-circle me-1"></i>
                            กำหนดคะแนนสำหรับข้อนี้ (แนะนำให้รวมทุกข้อ = 100 คะแนน)
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">สถานะคะแนน</label>
                        <div class="d-flex align-items-center">
                            <span id="question-score-status" class="badge bg-success">✓ คะแนนเหมาะสม</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Add Content Modal -->
    <div class="modal fade" id="addContentModal" tabindex="-1" aria-labelledby="addContentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addContentModalLabel">
                        <i class="bi bi-plus-circle me-2"></i>เพิ่มเนื้อหา
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิด" tabindex="0"></button>
                </div>
                <form id="addContentForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="contentTitle" class="form-label">ชื่อเนื้อหา *</label>
                                    <input type="text" class="form-control" id="contentTitle" placeholder="กรุณากรอกชื่อเนื้อหา" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="contentType" class="form-label">ประเภท *</label>
                                    <select class="form-select" id="contentType" required>
                                        <option value="">เลือกประเภท</option>
                                        <option value="video">วิดีโอ (YouTube)</option>
                                        <option value="document">เอกสาร</option>
                                        <option value="link">ลิงก์เว็บไซต์</option>
                                        <option value="pdf">ไฟล์ PDF</option>
                                        <option value="image">รูปภาพ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="contentUrl" class="form-label">ลิงก์/URL *</label>
                                    <input type="url" class="form-control" id="contentUrl" placeholder="https://www.youtube.com/watch?v=..." required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="contentCourse" class="form-label">คอร์สที่เกี่ยวข้อง</label>
                                    <select class="form-select" id="contentCourse">
                                        <option value="">เลือกคอร์ส (ไม่บังคับ)</option>
                                        <!-- ตัวเลือกคอร์สจะถูกโหลดโดย JavaScript -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contentDescription" class="form-label">คำอธิบาย</label>
                            <textarea class="form-control" id="contentDescription" rows="3" placeholder="กรุณากรอกคำอธิบายเนื้อหา"></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contentDuration" class="form-label">ระยะเวลาเรียน (นาที)</label>
                                    <input type="number" class="form-control" id="contentDuration" placeholder="0" min="0" max="480">
                                    <div class="form-text">
                                        <i class="bi bi-info-circle me-1"></i>
                                        จำนวนนาทีที่คาดว่าจะใช้ในการศึกษาเนื้อหานี้
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contentDifficulty" class="form-label">ระดับความยาก</label>
                                    <select class="form-select" id="contentDifficulty">
                                        <option value="beginner">เริ่มต้น</option>
                                        <option value="intermediate" selected>ปานกลาง</option>
                                        <option value="advanced">ขั้นสูง</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="contentIsRequired" checked>
                            <label class="form-check-label" for="contentIsRequired">
                                เนื้อหาที่ต้องศึกษา (แนะนำให้ผู้เรียนดูก่อนทำข้อสอบ)
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-1"></i>เพิ่มเนื้อหา
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Content Modal -->
    <div class="modal fade" id="editContentModal" tabindex="-1" aria-labelledby="editContentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editContentModalLabel">
                        <i class="bi bi-pencil me-2"></i>แก้ไขเนื้อหา
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิด" tabindex="0"></button>
                </div>
                <form id="editContentForm">
                    <input type="hidden" id="editContentId">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="editContentTitle" class="form-label">ชื่อเนื้อหา *</label>
                                    <input type="text" class="form-control" id="editContentTitle" placeholder="กรุณากรอกชื่อเนื้อหา" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editContentType" class="form-label">ประเภท *</label>
                                    <select class="form-select" id="editContentType" required>
                                        <option value="">เลือกประเภท</option>
                                        <option value="video">วิดีโอ (YouTube)</option>
                                        <option value="document">เอกสาร</option>
                                        <option value="link">ลิงก์เว็บไซต์</option>
                                        <option value="pdf">ไฟล์ PDF</option>
                                        <option value="image">รูปภาพ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="editContentUrl" class="form-label">ลิงก์/URL *</label>
                                    <input type="url" class="form-control" id="editContentUrl" placeholder="https://www.youtube.com/watch?v=..." required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editContentCourse" class="form-label">คอร์สที่เกี่ยวข้อง</label>
                                    <select class="form-select" id="editContentCourse">
                                        <option value="">เลือกคอร์ส (ไม่บังคับ)</option>
                                        <!-- ตัวเลือกคอร์สจะถูกโหลดโดย JavaScript -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="editContentDescription" class="form-label">คำอธิบาย</label>
                            <textarea class="form-control" id="editContentDescription" rows="3" placeholder="กรุณากรอกคำอธิบายเนื้อหา"></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editContentDuration" class="form-label">ระยะเวลาเรียน (นาที)</label>
                                    <input type="number" class="form-control" id="editContentDuration" placeholder="0" min="0" max="480">
                                    <div class="form-text">
                                        <i class="bi bi-info-circle me-1"></i>
                                        จำนวนนาทีที่คาดว่าจะใช้ในการศึกษาเนื้อหานี้
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editContentDifficulty" class="form-label">ระดับความยาก</label>
                                    <select class="form-select" id="editContentDifficulty">
                                        <option value="beginner">เริ่มต้น</option>
                                        <option value="intermediate">ปานกลาง</option>
                                        <option value="advanced">ขั้นสูง</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="editContentIsRequired">
                            <label class="form-check-label" for="editContentIsRequired">
                                เนื้อหาที่ต้องศึกษา (แนะนำให้ผู้เรียนดูก่อนทำข้อสอบ)
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-1"></i>บันทึกการแก้ไข
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal แสดงตัวอย่างข้อสอบ -->
    <div class="modal fade" id="quizPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-eye me-2"></i>
                        ตัวอย่างข้อสอบ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิด"></button>
                </div>
                <div class="modal-body" id="quizPreviewModalBody">
                    <!-- ข้อมูลตัวอย่างข้อสอบจะถูกแสดงที่นี่ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ยืนยันการลบ -->
    <div class="modal fade" id="deleteQuizModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ยืนยันการลบ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิด"></button>
                </div>
                <div class="modal-body">
                    <p>คุณแน่ใจหรือไม่ที่จะลบข้อสอบนี้? การดำเนินการนี้ไม่สามารถยกเลิกได้</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">ลบข้อสอบ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
    
    <!-- JavaScript Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase -->
    <script type="module" src="../../assets/js/firebase-config.js"></script>
    <script type="module" src="../../assets/js/auth.js"></script>
    <script type="module" src="../../assets/js/lazy-loading.js"></script>
    <script type="module" src="../../assets/js/manage-quizzes.js"></script>
                
                
</body>
</html>
