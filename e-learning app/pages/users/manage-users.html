<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>จัดการผู้ใช้ - E-Learning Platform</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../assets/css/main.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    
    <!-- DataTables Fix CSS -->
    
    <!-- Table Header Fix CSS -->
    
</head>
<body class="bg-light">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="../dashboard/admin-dashboard.html">
                <i class="bi bi-mortarboard-fill me-2"></i>
                E-Learning Platform
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" title="เปิด/ปิดเมนู">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto" id="mainMenu">
                    <li class="nav-item">
                        <a class="nav-link" href="../dashboard/admin-dashboard.html">
                            <i class="bi-house me-1"></i>
                            หน้าหลัก
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link active" href="manage-users.html">
                            <i class="bi-people me-1"></i>
                            จัดการผู้ใช้
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link" href="../courses/manage-courses.html">
                            <i class="bi-book me-1"></i>
                            จัดการคอร์ส
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link" href="../quiz/manage-quizzes.html">
                            <i class="bi-question-circle me-1"></i>
                            จัดการข้อสอบ
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link" href="../reports/system-reports.html">
                            <i class="bi-graph-up me-1"></i>
                            รายงานระบบ
                        </a>
                    </li>
                
                    <li class="nav-item">
                        <a class="nav-link" href="../settings/system-settings.html">
                            <i class="bi-gear me-1"></i>
                            การตั้งค่า
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" id="userDropdown">
                            <i class="bi bi-person-circle me-1"></i>
                            <span id="currentUserName">แอดมิน</span>
                        </a>
                        <ul class="dropdown-menu" id="userMenu">
                            <li>
                                <a class="dropdown-item" href="#" data-action="logout">
                                    <i class="bi-box-arrow-right me-2"></i>
                                    ออกจากระบบ
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Main Content -->
            <main class="col-12 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">
                        <i class="bi bi-people me-2"></i>
                        จัดการผู้ใช้
                    </h1>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                        <i class="bi bi-person-plus me-2"></i>
                        เพิ่มผู้ใช้ใหม่
                    </button>
                </div>

                <!-- Alert Container -->
                <div id="alertContainer"></div>

                <!-- Statistics Cards -->
                <div class="row mb-4">
                    <div class="col-md-2">
                        <div class="card text-primary border-primary">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 id="totalUsers">0</h4>
                                        <p class="mb-0">ผู้ใช้ทั้งหมด</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="bi bi-people fs-1 text-primary"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-success border-success">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 id="totalStudents">0</h4>
                                        <p class="mb-0">นักเรียน</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="bi bi-person fs-1 text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-warning border-warning">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 id="totalInstructors">0</h4>
                                        <p class="mb-0">ผู้สอน</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="bi bi-person-workspace fs-1 text-warning"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-info border-info">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 id="activeUsers">0</h4>
                                        <p class="mb-0">ผู้ใช้ที่ใช้งาน</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="bi bi-check-circle fs-1 text-info"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-warning border-warning">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 id="pendingApprovals">0</h4>
                                        <p class="mb-0">รออนุมัติ</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="bi bi-clock fs-1 text-warning"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-danger border-danger">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h4 id="rejectedUsers">0</h4>
                                        <p class="mb-0">ถูกปฏิเสธ</p>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="bi bi-x-circle fs-1 text-danger"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-list-ul me-2"></i>
                            รายการผู้ใช้
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="usersTable" class="table table-striped table-hover w-100">
                                <thead>
                                    <tr>
                                        <th>ชื่อผู้ใช้</th>
                                        <th>อีเมล</th>
                                        <th>ประเภท</th>
                                        <th>สถานะ</th>
                                        <th>สถานะการอนุมัติ</th>
                                        <th>วันที่สมัคร</th>
                                        <th>ล็อกอินล่าสุด</th>
                                        <th>จำนวนล็อกอิน</th>
                                        <th>การจัดการ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- ข้อมูลจะถูกโหลดด้วย JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel">
                        <i class="bi bi-person-plus me-2"></i>
                        เพิ่มผู้ใช้ใหม่
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิดหน้าต่างเพิ่มผู้ใช้ใหม่"></button>
                </div>
                <form id="addUserForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="userName" class="form-label">ชื่อผู้ใช้ *</label>
                                    <input type="text" class="form-control" id="userName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="userEmail" class="form-label">อีเมล *</label>
                                    <input type="email" class="form-control" id="userEmail" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="userPassword" class="form-label">รหัสผ่าน *</label>
                                    <input type="password" class="form-control" id="userPassword" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="userType" class="form-label">ประเภทผู้ใช้ *</label>
                                    <select class="form-select" id="userType" required>
                                        <option value="">เลือกประเภทผู้ใช้</option>
                                        <option value="student">นักเรียน</option>
                                        <option value="instructor">ผู้สอน</option>
                                        <option value="admin">แอดมิน</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="userDepartment" class="form-label">แผนก/สาขา</label>
                            <select class="form-select" id="userDepartment">
                                <option value="">เลือกแผนก/สาขา</option>
                                <option value="บัญชี/การเงิน">บัญชี/การเงิน</option>
                                <option value="ทรัพยากรบุคคล">ทรัพยากรบุคคล</option>
                                <option value="เทคโนโลยีสารสนเทศ">เทคโนโลยีสารสนเทศ</option>
                                <option value="การตลาด">การตลาด</option>
                                <option value="การขาย">การขาย</option>
                                <option value="การผลิต">การผลิต</option>
                                <option value="การวิจัยและพัฒนา">การวิจัยและพัฒนา</option>
                                <option value="การบริการลูกค้า">การบริการลูกค้า</option>
                                <option value="การจัดซื้อ">การจัดซื้อ</option>
                                <option value="การขนส่ง">การขนส่ง</option>
                                <option value="การบำรุงรักษา">การบำรุงรักษา</option>
                                <option value="การควบคุมคุณภาพ">การควบคุมคุณภาพ</option>
                                <option value="การฝึกอบรม">การฝึกอบรม</option>
                                <option value="การสื่อสารองค์กร">การสื่อสารองค์กร</option>
                                <option value="กฎหมาย">กฎหมาย</option>
                                <option value="ความปลอดภัย">ความปลอดภัย</option>
                                <option value="สิ่งแวดล้อม">สิ่งแวดล้อม</option>
                                <option value="อื่นๆ">อื่นๆ</option>
                            </select>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="userPhone" class="form-label">เบอร์โทรศัพท์</label>
                                    <input type="tel" class="form-control" id="userPhone">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="userStatus" class="form-label">สถานะ</label>
                                    <select class="form-select" id="userStatus">
                                        <option value="active">ใช้งาน</option>
                                        <option value="inactive">ระงับการใช้งาน</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>
                            เพิ่มผู้ใช้
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editUserModalLabel">
                        <i class="bi bi-pencil me-2"></i>
                        แก้ไขข้อมูลผู้ใช้
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิดหน้าต่างแก้ไขข้อมูลผู้ใช้"></button>
                </div>
                <form id="editUserForm">
                    <div class="modal-body">
                        <input type="hidden" id="editUserId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editUserName" class="form-label">ชื่อผู้ใช้ *</label>
                                    <input type="text" class="form-control" id="editUserName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editUserEmail" class="form-label">อีเมล *</label>
                                    <input type="email" class="form-control" id="editUserEmail" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editUserType" class="form-label">ประเภทผู้ใช้ *</label>
                                    <select class="form-select" id="editUserType" required>
                                        <option value="">เลือกประเภทผู้ใช้</option>
                                        <option value="student">นักเรียน</option>
                                        <option value="instructor">ผู้สอน</option>
                                        <option value="admin">แอดมิน</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editUserStatus" class="form-label">สถานะ</label>
                                    <select class="form-select" id="editUserStatus">
                                        <option value="active">ใช้งาน</option>
                                        <option value="inactive">ระงับการใช้งาน</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editUserApprovalStatus" class="form-label">สถานะการอนุมัติ</label>
                                    <select class="form-select" id="editUserApprovalStatus">
                                        <option value="pending">รอดำเนินการ</option>
                                        <option value="approved">อนุมัติแล้ว</option>
                                        <option value="rejected">ปฏิเสธ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="editUserDepartment" class="form-label">แผนก/สาขา</label>
                            <select class="form-select" id="editUserDepartment">
                                <option value="">เลือกแผนก/สาขา</option>
                                <option value="บัญชี/การเงิน">บัญชี/การเงิน</option>
                                <option value="ทรัพยากรบุคคล">ทรัพยากรบุคคล</option>
                                <option value="เทคโนโลยีสารสนเทศ">เทคโนโลยีสารสนเทศ</option>
                                <option value="การตลาด">การตลาด</option>
                                <option value="การขาย">การขาย</option>
                                <option value="การผลิต">การผลิต</option>
                                <option value="การวิจัยและพัฒนา">การวิจัยและพัฒนา</option>
                                <option value="การบริการลูกค้า">การบริการลูกค้า</option>
                                <option value="การจัดซื้อ">การจัดซื้อ</option>
                                <option value="การขนส่ง">การขนส่ง</option>
                                <option value="การบำรุงรักษา">การบำรุงรักษา</option>
                                <option value="การควบคุมคุณภาพ">การควบคุมคุณภาพ</option>
                                <option value="การฝึกอบรม">การฝึกอบรม</option>
                                <option value="การสื่อสารองค์กร">การสื่อสารองค์กร</option>
                                <option value="กฎหมาย">กฎหมาย</option>
                                <option value="ความปลอดภัย">ความปลอดภัย</option>
                                <option value="สิ่งแวดล้อม">สิ่งแวดล้อม</option>
                                <option value="อื่นๆ">อื่นๆ</option>
                            </select>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editUserPhone" class="form-label">เบอร์โทรศัพท์</label>
                                    <input type="tel" class="form-control" id="editUserPhone">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editUserProfile" class="form-label">ข้อมูลเพิ่มเติม</label>
                                    <textarea class="form-control" id="editUserProfile" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>
                            บันทึกการเปลี่ยนแปลง
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View User Modal -->
    <div class="modal fade" id="viewUserModal" tabindex="-1" aria-labelledby="viewUserModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewUserModalLabel">
                        <i class="bi bi-eye me-2"></i>
                        รายละเอียดผู้ใช้
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิดหน้าต่างรายละเอียดผู้ใช้"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <div class="mb-3">
                                <i class="bi bi-person-circle fs-1 text-primary"></i>
                            </div>
                            <h5 id="viewUserName" class="mb-1"></h5>
                            <span id="viewUserType" class="badge bg-primary"></span>
                        </div>
                        <div class="col-md-9">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">อีเมล:</label>
                                        <p id="viewUserEmail" class="mb-0"></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">สถานะ:</label>
                                        <p id="viewUserStatus" class="mb-0"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">แผนก/สาขา:</label>
                                        <p id="viewUserDepartment" class="mb-0"></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">เบอร์โทรศัพท์:</label>
                                        <p id="viewUserPhone" class="mb-0"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label fw-bold">ข้อมูลเพิ่มเติม:</label>
                                <p id="viewUserProfile" class="mb-0"></p>
                            </div>
                            
                            <hr>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">วันที่สมัคร:</label>
                                        <p id="viewUserCreatedAt" class="mb-0"></p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">ล็อกอินล่าสุด:</label>
                                        <p id="viewUserLastLogin" class="mb-0"></p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">จำนวนล็อกอิน:</label>
                                        <p id="viewUserLoginCount" class="mb-0"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
                    <button type="button" class="btn btn-primary" id="editFromViewBtn" tabindex="0">
                        <i class="bi bi-pencil me-2"></i>
                        แก้ไขข้อมูล
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger" id="deleteUserModalLabel">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        ยืนยันการลบผู้ใช้
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ปิดหน้าต่างยืนยันการลบผู้ใช้"></button>
                </div>
                <div class="modal-body">
                    <p>คุณแน่ใจหรือไม่ที่จะลบผู้ใช้ <strong id="deleteUserName"></strong>?</p>
                    <p class="text-danger small">
                        <i class="bi bi-info-circle me-1"></i>
                        การดำเนินการนี้ไม่สามารถยกเลิกได้ และจะลบข้อมูลที่เกี่ยวข้องทั้งหมด
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="bi bi-trash me-2"></i>
                        ลบผู้ใช้
                    </button>
                </div>
            </div>
        </div>
    </div>



    <!-- JavaScript Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <!-- Firebase -->
    <script type="module" src="../../assets/js/firebase-config.js"></script>
    <script type="module" src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/utils/date-formatter-legacy.js"></script>
    <script type="module" src="../../assets/js/manage-users.js"></script>
    <!-- ลบ ResponsiveTablesManager ออก เพราะไม่ต้องการ responsive control -->
    <!-- <script src="../../assets/js/responsive-tables-manager.js"></script> -->
</body>
</html>
