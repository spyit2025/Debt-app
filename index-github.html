<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>ระบบจัดการหนี้สิน</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css?v=2.2.0">
    <link rel="stylesheet" href="css/mobile-chrome-fix.css?v=2.2.0">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Meta tags for PWA -->
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ระบบจัดการหนี้สิน">
    
    <!-- Security headers -->
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="display-capture=()">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://code.jquery.com https://cdn.datatables.net https://*.firebaseapp.com https://*.googleapis.com https://*.gstatic.com;
        style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdn.datatables.net;
        img-src 'self' data: https:;
        font-src 'self' https://cdn.jsdelivr.net;
        connect-src 'self' https://*.firebaseapp.com https://*.googleapis.com https://*.gstatic.com https://cdn.datatables.net https://code.jquery.com;
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    ">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-calculator me-2"></i>
                ระบบจัดการหนี้สิน
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="loginLink">เข้าสู่ระบบ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="pages/auth/register.html">สมัครสมาชิก</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <!-- Login Form -->
                <div class="login-container">
                    <div class="card">
                        <div class="card-body">
                            <h2 class="card-title text-center mb-4">
                                <i class="fas fa-sign-in-alt me-2"></i>
                                เข้าสู่ระบบ
                            </h2>
                            
                            <form id="loginForm">
                                <div class="mb-3">
                                    <label for="email" class="form-label">อีเมล</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="password" class="form-label">รหัสผ่าน</label>
                                    <input type="password" class="form-control" id="password" required>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="rememberMe">
                                    <label class="form-check-label" for="rememberMe">
                                        จดจำการเข้าสู่ระบบ
                                    </label>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-sign-in-alt me-2"></i>
                                    เข้าสู่ระบบ
                                </button>
                            </form>
                            
                            <div class="text-center mt-3">
                                <p class="mb-0">
                                    ยังไม่มีบัญชี? 
                                    <a href="pages/auth/register.html" class="text-decoration-none">
                                        สมัครสมาชิก
                                    </a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Custom Scripts -->
    <script src="js/firebase-config.js?v=2.2.0"></script>
    <script src="js/firebase-utils.js?v=2.2.0"></script>
    <script src="js/auth.js?v=2.2.0"></script>
    <script src="js/login.js?v=2.2.0"></script>
    
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Try different paths for Service Worker registration
                const swPaths = [
                    'sw.js?v=2.2.1',
                    './sw.js?v=2.2.1',
                    '/sw.js?v=2.2.1'
                ];
                
                const tryRegisterSW = (pathIndex = 0) => {
                    if (pathIndex >= swPaths.length) {
                        console.warn('Service Worker registration failed: All paths attempted');
                        return;
                    }
                    
                    const swPath = swPaths[pathIndex];
                    console.log(`Attempting to register Service Worker from: ${swPath}`);
                    
                    navigator.serviceWorker.register(swPath)
                        .then(registration => {
                            console.log('Service Worker registered successfully:', registration);
                            console.log('Service Worker scope:', registration.scope);
                        })
                        .catch(error => {
                            console.warn(`Service Worker registration failed for ${swPath}:`, error);
                            
                            // Try next path if available
                            if (pathIndex + 1 < swPaths.length) {
                                console.log('Trying next path...');
                                tryRegisterSW(pathIndex + 1);
                            } else {
                                console.error('Service Worker registration failed: All paths exhausted');
                                console.log('This is normal if the app is not deployed or sw.js is not available');
                            }
                        });
                };
                
                // Start registration attempts
                tryRegisterSW();
            });
        } else {
            console.log('Service Worker not supported in this browser');
        }
    </script>
    
    <!-- Mobile Console (Eruda) -->
    <script>
        // เพิ่ม mobile console สำหรับ debugging
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/eruda@3.0.0/eruda.min.js';
            script.onload = function() {
                eruda.init();
            };
            document.head.appendChild(script);
        }
    </script>
</body>
</html>
